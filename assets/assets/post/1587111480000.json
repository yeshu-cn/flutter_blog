{"title":"flavor权限，依赖，源文件配置","createTime":1587111480000,"updateTime":-1,"category":"default","content":" \n # flavor权限，依赖，源文件配置 \n  \n * 为ProductFlavor设置依赖 \n * 为ProductFlavor设置权限 \n * 不同的ProductFlavor使用不同的源码文件 \n  \n  \n ## 添加三种flavor \n ``` \n android { \n  \n     ... \n  \n     productFlavors { \n         free { \n             applicationId \"com.yeshu.app.free\" \n             versionCode 1 \n             versionName \"1.0.0\" \n         } \n  \n         premium { \n             applicationId \"com.yeshu.app.premium\" \n             versionCode 1 \n             versionName \"1.0.0\" \n         } \n  \n         enterprise { \n             applicationId \"com.yeshu.app.enterprise\" \n             versionCode 1 \n             versionName \"1.0.0\" \n        } \n    } \n    .... \n  \n } \n ``` \n  \n ## 添加特定权限 \n * app/src/main/AndroidManifest.xml (默认的，包含公共的信息) \n * app/src/free/AndroidManifest.xml （包含flavor特定的信息） \n * app/src/premium/AndroidManifest.xml \n * app/src/enterprise/AndroidManifest.xml \n  \n free，preminum,enterprise对应的AnroidMainfest.xml中分别添加自己需要permission。 \n 最终程序打包时会将flavor中的AndroidMainfest.xml和默认的AndroidMainfest.xml合并 \n  \n ## 添加特定依赖 \n 使用`flavorNameImplementation`指定只有特定的flavor才依赖 \n ``` \n // 所有的都会包含 \n Implementation 'com.android.support:support-v4:22.2.1' \n // 只有free的才包含 \n freeImplementation 'com.google.android.gms:play-services-ads:7.8.0' \n // 只有premium的才包含 \n premiumImplementation 'com.google.android.gms:play-services-ads:7.8.0' \n ``` \n  \n ## 使用不同的源码文件 \n 默认的文件目录结构如下 \n * /src/main/java/com/yeshu/app/main/**.java（公共的源文件） \n * /src/free/java/com/yeshu/app/main/**.java（free专有源文件） \n * /src/premium/java/com/yeshu/app/main/**.java （premium专有源文件） \n  \n ## gradle动态指定文件目录 \n ``` \n     sourceSets.all { set -> \n          \n         if (name == \"play\") { \n             // play flavor指定源码和资源目录 \n             java.srcDirs += \"src/startUpAdPlay/java\" \n             res.srcDirs += \"src/startUpAdPlay/res\" \n         } else { \n  \n             // 指定其他flavor的源码和资源目录 \n             java.srcDirs += \"src/startUpAd/java\" \n             res.srcDirs += \"src/startUpAd/res\" \n             manifest.srcFile \"src/startUpAd/AndroidManifest.xml\" \n         } \n     } \n ``` \n  \n ## gradle动态添加依赖 \n ``` \n applicationVariants.all { variant -> \n         if (!variant.flavorName.equalsIgnoreCase(\"play\")) { \n             // 非play flavor才添加某个依赖 \n             dependencies { \n                 implementation \"xxxx\" \n             } \n         } \n     } \n ``` \n  \n ## 资料 \n * [implement flavor dependent dependencies](https://futurestud.io/tutorials/android-how-to-implement-productflavor-dependent-dependencies-with-gradle) \n * [implement flavor dependent persissions](https://futurestud.io/tutorials/how-to-implement-product-flavor-dependent-permissions) \n * [flavor使用官方指南](https://developer.android.com/studio/build/build-variants) \n "}